<div class="max-w-[800px] shadow-lg w-full select-none mx-auto bg-[var(--primary-color)] rounded-xl p-8 py-8 flex items-center justify-center">
    <%= form_with model: @article, local: true, class: 'w-full' do |f| %>
        <div class="h-auto mb-6 w-full relative">
            <p class="text-lg text-[var(--light-blue)] font-mono mb-1"><%= f.label :title, "Title" %><br/></p>
            <%= f.text_field :title, placeholder: "Enter Title", class: "border !border-[var(--light-blue)] transition-all duration-300 focus:ring-2 focus:ring-offset-2 focus:!ring-offset-[var(--primary-color)] focus:ring-[var(--secondary-color)] font-light text-lg rounded-lg px-3 bg-transparent !outline-none text-white tracking-wide w-full h-12" %>
        </div>
        <div class="h-auto mb-6 w-full relative">
            <p class="text-lg text-[var(--light-blue)] font-mono mb-1"><%= f.label :categories_list, "Categories" %><br/></p>
            <% @cat = @categories.map { |c| c.name } %>
            <%= f.select(:categories_list, @cat, { :multiple => true }, { :class => 'hidden border !border-[var(--light-blue)] transition-all duration-300 focus:ring-2 focus:ring-offset-2 focus:!ring-offset-[var(--primary-color)] focus:ring-[var(--secondary-color)] font-light text-lg rounded-lg px-3 bg-transparent !outline-none text-white tracking-wide w-full h-12' }) %>
            <div id="selected_category_list_div" class="relative flex items-center justify-start gap-2 border !border-[var(--light-blue)] transition-all duration-300 focus:ring-2 focus:ring-offset-2 focus:!ring-offset-[var(--primary-color)] focus:ring-[var(--secondary-color)] font-light text-lg rounded-lg px-3 bg-transparent !outline-none text-white tracking-wide w-full h-auto min-h-12">
                Select Category
                <span class="absolute right-3 top-3 rounded-full bg-[var(--light-blue)] text-[var(--primary-color)]" onclick="toggle_category_div(this)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5 p-1" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708"/>
                    </svg>
                </span>
            </div>
            <div id="category_list_div" class="absolute transition-height select-none duration-300 z-10 w-full h-0 py-1 overflow-y-scroll no-scrollbar left-0 top-24 bg-[var(--primary-color)] rounded-lg !border-[var(--light-blue)]">
                <% @categories.each_with_index do |category, idx| %>
                    <p class="px-3 py-2 cursor-pointer hover:bg-[var(--mid-blue)] text-[var(--secondary-color)] text-sm" onclick="select_categories(<%= idx %>)"><%= category.name %></p>
                <% end %>
            </div>
        </div>
        <div class="h-auto mb-6 w-full relative">
            <p class="text-lg text-[var(--light-blue)] font-mono mb-1"><%= f.label :description, "Description" %><br/></p>
            <%= f.text_area :description, placeholder: "Enter Description", rows: 5, class: "border !border-[var(--light-blue)] transition-all duration-300 focus:ring-2 focus:ring-offset-2 focus:!ring-offset-[var(--primary-color)] focus:ring-[var(--secondary-color)] font-light text-lg rounded-lg px-3 bg-transparent !outline-none text-white tracking-wide w-full h-12" %>
        </div>
        <div class="border cursor-pointer mx-auto bg-[var(--secondary-color)] text-lg text-[var(--primary-color)] font-medium w-fit rounded-lg font-medium p-2 px-4 hover:-translate-y-0.5 transition-all duration-300">
            <%= f.submit %>
        </div>
    <% end %>
</div>

<script>
    let select_input = document.getElementById('article_categories_list')
    let selected_category_list_div = document.getElementById('selected_category_list_div')
    let category_list_div = document.getElementById('category_list_div')
    let selected_categories = []

    function toggle_category_div(e) {
        category_list_div.classList.toggle('!h-44')
        category_list_div.classList.toggle('border')
        e.classList.toggle('rotate-180')
    }

    function display_categories() {
        selected_category_list_div.innerHTML = "<span class='absolute right-3 top-3 rounded-full bg-[var(--light-blue)] text-[var(--primary-color)]' onclick='toggle_category_div()'><svg xmlns='http://www.w3.org/2000/svg' fill='currentColor' class='w-4 h-4' viewBox='0 0 16 16'><path fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708'/></svg></span>"
        for(i = 0; i < selected_categories.length; i++) {
            let new_div = document.createElement('div')
            new_div.classList.add("w-fit", "h-8", "border", "border-[var(--secondary-color)]", "text-[var(--secondary-color)]", "text-sm", "rounded-full", "flex", "items-center", "justify-center", "px-3")
            new_div.innerHTML = selected_categories[i]
            new_div.addEventListener('click', () => {
                selected_categories = selected_categories.filter(function(category) { return category != new_div.innerHTML })
                select_input.options[i].selected = false
                display_categories()
            })
            selected_category_list_div.appendChild(new_div)
        }
    }

    function select_categories(idx) {
        if (select_input.options[idx].selected == true) {
            select_input.options[idx].selected = false
            selected_categories = selected_categories.filter(function(category) { return category != select_input.options[idx].value })
            display_categories()
        } else {
            select_input.options[idx].selected = true
            selected_categories.push(select_input.options[idx].value)
            display_categories()
        }
    }
</script>